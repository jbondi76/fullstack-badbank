import t,{forwardRef as e,useState as n,useMemo as o,Fragment as r,useRef as i}from"react";import{storybookExcludedControlParams as a}from"@lg-tools/storybook-utils";import c from"@leafygreen-ui/button";import{css as l,cx as s}from"@leafygreen-ui/emotion";import{palette as u}from"@leafygreen-ui/palette";import{Transition as f}from"react-transition-group";import p from"prop-types";import{useViewportSize as d,useMutationObserver as g,useObjectDependency as h,usePrevious as m,useIsomorphicLayoutEffect as v}from"@leafygreen-ui/hooks";import{usePopoverContext as y,usePopoverPortalContainer as w}from"@leafygreen-ui/leafygreen-provider";import{createUniqueClassName as E,consoleOnce as b}from"@leafygreen-ui/lib";import P from"@leafygreen-ui/portal";import{transitionDuration as j}from"@leafygreen-ui/tokens";function x(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function O(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?x(Object(n),!0).forEach((function(e){S(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function C(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,e);if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}function S(t,e,n){return(e=C(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function T(){return T=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},T.apply(this,arguments)}function D(t,e){if(null==t)return{};var n,o,r=function(t,e){if(null==t)return{};var n,o,r={},i=Object.keys(t);for(o=0;o<i.length;o++)n=i[o],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(o=0;o<i.length;o++)n=i[o],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function N(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function H(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,i,a,c=[],l=!0,s=!1;try{if(i=(n=n.call(t)).next,0===e);else for(;!(l=(o=i.call(n)).done)&&(c.push(o.value),c.length!==e);l=!0);}catch(t){s=!0,r=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw r}}return c}}(t,e)||B(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(t){return function(t){if(Array.isArray(t))return V(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||B(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(t,e){if(t){if("string"==typeof t)return V(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?V(t,e):void 0}}function V(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var M={Top:"top",Bottom:"bottom",Left:"left",Right:"right",CenterVertical:"center-vertical",CenterHorizontal:"center-horizontal"},F={Start:"start",Middle:"middle",End:"end",Fit:"fit"};function L(t){var e=t.useRelativePositioning,n=t.spacing,o=t.align,r=t.justify,i=t.referenceElViewportPos,a=void 0===i?z:i,c=t.referenceElDocumentPos,l=void 0===c?z:c,s=t.contentElViewportPos,u=void 0===s?z:s,f=t.contentElDocumentPos,p=void 0===f?z:f,d=t.scrollContainer,g=t.windowHeight,h=void 0===g?window.innerHeight:g,m=t.windowWidth,v=void 0===m?window.innerWidth:m,y=d?d.offsetWidth:v,w=d?d.offsetHeight:h,E={windowWidth:y,windowHeight:w,referenceElViewportPos:a,contentElViewportPos:u,spacing:n},b=function(t,e){var n=e.spacing,o=e.windowWidth,r=e.windowHeight,i=e.contentElViewportPos,a=e.referenceElViewportPos,c=[t].concat(R(tt[t]));return c.find((function(t){return[M.Top,M.Bottom,M.CenterVertical].includes(t)?_({top:J({align:t,contentElPos:i,referenceElPos:a,spacing:n}),windowHeight:r,contentHeight:i.height}):!![M.Left,M.Right,M.CenterHorizontal].includes(t)&&Q({left:K({align:t,contentElPos:i,referenceElPos:a,spacing:n}),windowWidth:o,contentWidth:i.width})}))||t}(o,E),P=function(t,e,n){var o,r,i=n.spacing,a=n.windowWidth,c=n.windowHeight,l=n.contentElViewportPos,s=n.referenceElViewportPos,u=[t].concat(R(et[t]));switch(e){case M.Top:case M.Bottom:case M.CenterVertical:return null!==(o=u.find((function(t){return Q({contentWidth:t===F.Fit?s.width:l.width,windowWidth:a,left:K({contentElPos:l,referenceElPos:s,spacing:i,align:e,justify:t})})})))&&void 0!==o?o:et[t][0];case M.Left:case M.Right:case M.CenterHorizontal:return null!==(r=u.find((function(t){return _({contentHeight:t===F.Fit?s.height:l.height,windowHeight:c,top:J({contentElPos:l,referenceElPos:s,spacing:i,align:e,justify:t})})})))&&void 0!==r?r:et[t][0]}}(r,b,E),j=function(t){var e,n,o=t.align,r=t.justify,i=Z[o],a=null!==(e=i.x)&&void 0!==e?e:U[r],c=null!==(n=i.y)&&void 0!==n?n:I[r];return"".concat(a," ").concat(c)}({align:b,justify:P}),x=function(t,e){var n=.8;switch(t){case M.Top:return"translate3d(0, ".concat(e,"px, 0) scale(").concat(n,")");case M.Bottom:return"translate3d(0, -".concat(e,"px, 0) scale(").concat(n,")");case M.Left:return"translate3d(".concat(e,"px, 0, 0) scale(").concat(n,")");case M.Right:return"translate3d(-".concat(e,"px, 0, 0) scale(").concat(n,")");case M.CenterHorizontal:case M.CenterVertical:return"scale(".concat(n,")")}}(b,n);return 0===Math.floor(u.width)&&r!==F.Fit?{align:o,justify:r,positionCSS:{left:0,top:0,transform:x,transformOrigin:j}}:e?{align:b,justify:P,positionCSS:O(O({},q({align:b,justify:P,referenceElDocumentPos:l,contentElDocumentPos:p,spacing:n})),{},{transformOrigin:j,transform:x})}:{align:b,justify:P,positionCSS:O(O({},G({align:b,justify:P,referenceElDocumentPos:l,contentElDocumentPos:p,spacing:n,windowHeight:w,windowWidth:y})),{},{transformOrigin:j,transform:x})}}var z={top:0,bottom:0,left:0,right:0,height:0,width:0},W=function(t,e){var n=t.getBoundingClientRect(),o=n.top,r=n.bottom,i=n.left,a=n.right,c=n.width;return{top:o,bottom:r,left:i,right:a,height:t.offsetHeight,width:e?c:parseFloat(getComputedStyle(t).width)}};function k(t,e,n){if(!t)return z;var o=W(t,n),r=o.top,i=o.bottom,a=o.left,c=o.right,l=o.height,s=o.width;if(e){var u=e.scrollTop,f=e.scrollLeft,p=e.getBoundingClientRect();return{top:r+u-p.top,bottom:i+u-p.bottom,left:a+f-p.left,right:c+f-p.right,height:l,width:s}}var d=window,g=d.scrollX,h=d.scrollY;return{top:r+h,bottom:i+h,left:a+g,right:c+g,height:l,width:s}}function A(t,e,n){if(!t)return z;var o=W(t,n),r=o.top,i=o.bottom,a=o.left,c=o.right,l=o.height,s=o.width;if(e){var u=e.getBoundingClientRect();return{top:r-u.top,bottom:i-u.bottom,left:a-u.left,right:c-u.right,height:l,width:s}}return{top:r,bottom:i,left:a,right:c,height:l,width:s}}var I=S(S(S(S({},F.Start,"top"),F.Middle,"center"),F.End,"bottom"),F.Fit,"center"),U=S(S(S(S({},F.Start,"left"),F.Middle,"center"),F.End,"right"),F.Fit,"center"),Z=S(S(S(S(S(S({},M.Left,{x:"right"}),M.Right,{x:"left"}),M.Top,{y:"bottom"}),M.Bottom,{y:"top"}),M.CenterHorizontal,{x:"center"}),M.CenterVertical,{y:"center"});var X=S(S(S(S({},F.Start,{top:0}),F.End,{bottom:0}),F.Middle,(function(t){var e=t.contentElDocumentPos,n=t.referenceElDocumentPos;return{top:"".concat(n.height/2-e.height/2,"px")}})),F.Fit,{top:0,bottom:0}),Y=S(S(S(S({},F.Start,{left:0}),F.End,{right:0}),F.Middle,(function(t){var e=t.contentElDocumentPos,n=t.referenceElDocumentPos;return{left:"".concat(n.width/2-e.width/2,"px")}})),F.Fit,{left:0,right:0}),$=S(S(S(S(S(S({},M.Top,{constant:function(t){var e=t.spacing;return{bottom:"calc(100% + ".concat(e,"px)")}},justifyPositions:Y}),M.Bottom,{constant:function(t){var e=t.spacing;return{top:"calc(100% + ".concat(e,"px)")}},justifyPositions:Y}),M.CenterVertical,{constant:function(t){var e=t.referenceElDocumentPos;return{top:"calc(".concat(e.height/2,"px - 50%)")}},justifyPositions:Y}),M.Left,{constant:function(t){var e=t.spacing;return{right:"calc(100% + ".concat(e,"px)")}},justifyPositions:X}),M.Right,{constant:function(t){var e=t.spacing;return{left:"calc(100% + ".concat(e,"px)")}},justifyPositions:X}),M.CenterHorizontal,{constant:function(t){var e=t.referenceElDocumentPos;return{left:"calc(".concat(e.width/2,"px - 50%)")}},justifyPositions:X});function q(t){var e,n=t.align,o=t.justify,r=t.referenceElDocumentPos,i=t.contentElDocumentPos,a=t.spacing,c=$[n],l=c.justifyPositions[o],s={contentElDocumentPos:i,referenceElDocumentPos:r,spacing:a};return O(O({},null===(e=c.constant)||void 0===e?void 0:e.call(c,s)),"function"==typeof l?l(s):l)}function G(t){var e=t.align,n=t.justify,o=t.referenceElDocumentPos,r=t.contentElDocumentPos,i=t.spacing,a=t.windowWidth,c=t.windowHeight,l=K({align:e,justify:n,referenceElPos:o,contentElPos:r,spacing:i}),s="".concat(l,"px"),u="".concat(J({align:e,justify:n,referenceElPos:o,contentElPos:r,spacing:i}),"px");return n!==F.Fit?{left:s,top:u}:[M.Left,M.Right,M.CenterHorizontal].includes(e)?{left:s,top:u,bottom:"".concat(c-o.bottom,"px")}:{left:s,top:u,right:"".concat(a-(l+o.width),"px")}}function J(t){var e=t.align,n=t.justify,o=t.contentElPos,r=t.referenceElPos,i=t.spacing;switch(e){case M.Left:case M.Right:case M.CenterHorizontal:switch(n){case F.Start:case F.Fit:return r.top;case F.End:return r.top+r.height-o.height;case F.Middle:default:return r.top-(o.height-r.height)/2}case M.CenterVertical:return r.top-(o.height-r.height)/2;case M.Top:return r.top-o.height-i;case M.Bottom:default:return r.top+r.height+i}}function K(t){var e=t.align,n=t.justify,o=t.contentElPos,r=t.referenceElPos,i=t.spacing;switch(e){case M.Top:case M.Bottom:case M.CenterVertical:switch(n){case F.End:return r.left+r.width-o.width;case F.Middle:return r.left-(o.width-r.width)/2;case F.Start:case F.Fit:default:return r.left}case M.Left:return r.left-o.width-i;case M.Right:return r.left+r.width+i;case M.CenterHorizontal:default:return r.left-(o.width-r.width)/2}}function Q(t){var e=t.left,n=t.windowWidth,o=t.contentWidth;return e>=0&&!(e+o>n)}function _(t){var e=t.top,n=t.windowHeight,o=t.contentHeight;return e>=0&&!(e+o>n)}var tt=S(S(S(S(S(S({},M.Top,[M.Bottom]),M.Bottom,[M.Top]),M.Left,[M.Right]),M.Right,[M.Left]),M.CenterHorizontal,[M.Left,M.Right]),M.CenterVertical,[M.Top,M.Bottom]);var et=S(S(S(S({},F.Start,[F.End,F.Middle]),F.Middle,[F.End,F.Start]),F.End,[F.Start,F.Middle]),F.Fit,[F.Middle,F.Start,F.End]);var nt,ot,rt,it,at,ct=["active","spacing","align","justify","adjustOnMutation","children","className","popoverZIndex","refEl","usePortal","portalClassName","portalContainer","portalRef","scrollContainer","onEnter","onEntering","onEntered","onExit","onExiting","onExited"],lt=["transform"],st=l(nt||(nt=N(["\n  position: absolute;\n  transition: transform ","ms ease-in-out,\n    opacity ","ms ease-in-out;\n  opacity: 0;\n"])),j.default,j.default),ut={attributes:!0,characterData:!0,childList:!0,subtree:!0},ft=E("popover-content"),pt=e((function(e,i){var a,c=e.active,u=void 0!==c&&c,p=e.spacing,E=void 0===p?10:p,x=e.align,O=void 0===x?M.Bottom:x,C=e.justify,R=void 0===C?F.Start:C,B=e.adjustOnMutation,V=void 0!==B&&B,z=e.children,W=e.className,I=e.popoverZIndex,U=e.refEl,Z=e.usePortal,X=void 0===Z||Z,Y=e.portalClassName,$=e.portalContainer,q=e.portalRef,G=e.scrollContainer,J=e.onEnter,K=e.onEntering,Q=e.onEntered,_=e.onExit,tt=e.onExiting,et=e.onExited,nt=D(e,ct),pt=H(n(null),2),dt=pt[0],gt=pt[1],ht=H(n(null),2),mt=ht[0],vt=ht[1],yt=H(n(0),2),wt=yt[0],Et=yt[1],bt=y().setIsPopoverOpen,Pt=w(),jt=Pt.portalContainer,xt=Pt.scrollContainer;jt=$||jt,xt=G||xt,X&&xt&&(xt.contains(jt)||b.warn("To ensure correct positioning make sure that the portalContainer element is inside of the scrollContainer"));var Ot=t.useRef(mt);Ot.current=mt;var Ct=null;if(U&&U.current)Ct=U.current;else if(dt){var St=dt.parentNode;St&&St instanceof HTMLElement&&(Ct=St)}var Tt=d(),Dt=V&&u,Nt=g(Ct,ut,Date.now,Dt),Ht=g(null==mt?void 0:mt.parentNode,ut,Date.now,Dt),Rt=h(A(Ct,xt,!0)),Bt=h(A(null==mt?void 0:mt.parentNode,xt)),Vt=h(o((function(){return k(Ct,xt,!0)}),[Ct,xt,Tt,Nt,u,O,R,wt])),Mt=h(o((function(){return k(mt)}),[null==mt?void 0:mt.parentNode,Tt,Ht,u,O,R,wt])),Ft=m(R),Lt=m(O),zt=Ft!==R&&(R===F.Fit||Ft===F.Fit)||Lt!==O&&R===F.Fit;v((function(){zt&&Et((function(t){return t+1}))}),[zt]);var Wt=H(n(!1),2),kt=Wt[0],At=Wt[1];if(v((function(){return At(!0)}),[]),!kt)return null;var It,Ut=L({useRelativePositioning:!X,spacing:E,align:O,justify:R,referenceElViewportPos:Rt,referenceElDocumentPos:Vt,contentElViewportPos:Bt,contentElDocumentPos:Mt,scrollContainer:xt}),Zt=Ut.align,Xt=Ut.justify,Yt=Ut.positionCSS,$t=Yt.transform,qt=D(Yt,lt),Gt=l(ot||(ot=N(["\n      opacity: 1;\n      position: ",";\n      pointer-events: initial;\n    "])),X?"":"absolute"),Jt=X?P:r,Kt={className:jt?void 0:Y,container:null!==(a=jt)&&void 0!==a?a:void 0,portalRef:q},Qt=X?Kt:{};return It=null==z?null:"function"==typeof z?z({align:Zt,justify:Xt,referenceElPos:Vt}):z,t.createElement(f,{nodeRef:Ot,in:u,timeout:j.default,mountOnEnter:!0,unmountOnExit:!0,appear:!0,onEntering:K,onEnter:J,onEntered:function(){bt(!0);for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];null==Q||Q.apply(void 0,e)},onExiting:tt,onExit:_,onExited:function(){bt(!1);for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];null==et||et.apply(void 0,e)}},(function(e){return t.createElement(t.Fragment,null,t.createElement("span",{ref:gt,className:l(rt||(rt=N(["\n                display: none;\n              "])))}),t.createElement(Jt,Qt,t.createElement("div",T({},nt,{ref:i,className:s(st,l(qt),S(S(S({},l({transform:$t}),"entering"===e||"exiting"===e),Gt,"entered"===e),l(it||(it=N(["\n                      z-index: ",";\n                    "])),I),"number"==typeof I),W,S({},l(at||(at=N(["\n                      transition-delay: 0ms;\n                    "]))),"exiting"===e))}),t.createElement("div",{ref:vt,className:ft},It))))}))}));pt.displayName="Popover",pt.propTypes={children:p.oneOfType([p.node,p.func]),active:p.bool,className:p.string,align:p.oneOf(Object.values(M)),justify:p.oneOf(Object.values(F)),refEl:p.shape({current:"undefined"!=typeof window?p.instanceOf(Element):p.any}),usePortal:p.bool,portalClassName:p.string,spacing:p.number,adjustOnMutation:p.bool};var dt,gt,ht,mt,vt,yt,wt,Et,bt,Pt,jt,xt=["refButtonPosition","buttonText"],Ot=["refButtonPosition","buttonText"],Ct=l(dt||(dt=N(["\n  border: 1px solid ",";\n  text-align: center;\n  padding: 12px;\n  max-height: 100%;\n  overflow: hidden;\n  // Reset these properties since they'll be inherited\n  // from the container element when not using a portal.\n  font-size: initial;\n  color: initial;\n  background-color: initial;\n"])),u.gray.light1),St=l(gt||(gt=N(["\n  position: relative;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"]))),Tt=l(ht||(ht=N(["\n  width: 500px;\n  height: 90vh;\n  background-color: ",";\n  overflow: scroll;\n  position: relative;\n"])),u.gray.light2),Dt=l(mt||(mt=N(["\n  position: relative;\n  height: 130vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"]))),Nt=l(vt||(vt=N(["\n  position: relative;\n"]))),Ht={centered:l(yt||(yt=N(["\n    position: relative;\n  "]))),top:l(wt||(wt=N(["\n    top: 0;\n    position: absolute;\n  "]))),right:l(Et||(Et=N(["\n    right: 0;\n    position: absolute;\n  "]))),bottom:l(bt||(bt=N(["\n    bottom: 0;\n    position: absolute;\n  "]))),left:l(Pt||(Pt=N(["\n    left: 0;\n    position: absolute;\n  "])))},Rt={title:"Components/Popover",component:pt,parameters:{default:"LiveExample",controls:{exclude:[].concat(R(a),["children","active","refEl","portalClassName","refButtonPosition","usePortal"])},generate:{combineArgs:{align:Object.values(M),justify:Object.values(F)},args:{active:!0,children:t.createElement("div",{className:Ct},"Popover content")},decorator:function(e){var n=i(null);return t.createElement("div",{className:l(jt||(jt=N(["\n              position: relative;\n              width: 50vw;\n              height: 150px;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n            "])))},t.createElement(c,{ref:n},"refEl"),t.createElement(e,{refEl:n}))}}},args:{align:M.Top,justify:F.Start,spacing:10,adjustOnMutation:!1,buttonText:"Button Text"},argTypes:{buttonText:{type:"string",description:"Storybook only prop. Used to change the reference button text"},refButtonPosition:{options:["centered","top","right","bottom","left"],control:{type:"select"},description:"Storybook only prop. Used to change position of the reference button",defaultValue:"centered"}}},Bt=function(e){var o=e.refButtonPosition,r=e.buttonText,i=D(e,xt),a=H(n(!1),2),l=a[0],u=a[1],f=Ht[o];return t.createElement("div",{className:St},t.createElement(c,{className:s(Nt,f),onClick:function(){return u((function(t){return!t}))}},r,t.createElement(pt,T({},i,{active:l}),t.createElement("div",{className:Ct},"Popover content"))))};Bt.parameters={chromatic:{disableSnapshot:!0}};var Vt=function(e){var o=e.refButtonPosition,r=e.buttonText,a=D(e,Ot),l=H(n(!1),2),s=l[0],u=l[1],f=i(null),p=i(null),d=Ht[o];return t.createElement("div",{className:Tt},t.createElement("div",{className:Dt,ref:p},t.createElement(c,{onClick:function(){return u((function(t){return!t}))},className:d},r,t.createElement(pt,T({},a,{active:s,portalContainer:p.current,portalRef:f,scrollContainer:p.current}),t.createElement("div",{className:Ct},"Popover content")))))};Vt.parameters={chromatic:{disableSnapshot:!0}},Vt.args={usePortal:!0},Vt.argTypes={usePortal:{control:"none"},portalClassName:{control:"none"},refEl:{control:"none"},className:{control:"none"},active:{control:"none"}};var Mt=function(){};export{Mt as Generated,Bt as LiveExample,Vt as ScrollableContainer,Rt as default};
